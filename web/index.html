<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Interview Assistant</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            padding: 1rem 1.5rem;
            background: #16213e;
            border-bottom: 1px solid #0f3460;
        }
        header h1 { font-size: 1.2rem; font-weight: 600; }
        header p { font-size: 0.85rem; color: #888; margin-top: 0.25rem; }
        #chat {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .msg {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .msg.user {
            align-self: flex-end;
            background: #0f3460;
            color: #e0e0e0;
        }
        .msg.agent {
            align-self: flex-start;
            background: #1a1a3e;
            border: 1px solid #333;
        }
        .msg.system {
            align-self: center;
            background: transparent;
            color: #666;
            font-size: 0.85rem;
        }
        #input-area {
            padding: 1rem 1.5rem;
            background: #16213e;
            border-top: 1px solid #0f3460;
            display: flex;
            gap: 0.75rem;
        }
        #input-area input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #333;
            border-radius: 8px;
            background: #1a1a2e;
            color: #eee;
            font-size: 1rem;
            outline: none;
        }
        #input-area input:focus { border-color: #0f3460; }
        #input-area button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            background: #e94560;
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }
        #input-area button:hover { background: #c73c54; }
        #input-area button:disabled { background: #555; cursor: not-allowed; }
        #status {
            font-size: 0.8rem;
            color: #666;
            padding: 0.25rem 1.5rem;
            background: #16213e;
        }
    </style>
</head>
<body>
    <header>
        <h1>Interview Assistant</h1>
        <p>Ask questions about the company, role, team, or process.</p>
    </header>
    <div id="chat">
        <div class="msg system">Connected. Type a question below.</div>
    </div>
    <div id="status">Ready</div>
    <div id="input-area">
        <input type="text" id="input" placeholder="Type your question..." autofocus />
        <button id="send" onclick="sendMessage()">Send</button>
    </div>

    <script>
        const chat = document.getElementById('chat');
        const input = document.getElementById('input');
        const sendBtn = document.getElementById('send');
        const status = document.getElementById('status');

        const wsUrl = `ws://${location.host}/ws`;
        let ws = null;
        let currentAgentMsg = null;

        function connect() {
            ws = new WebSocket(wsUrl);
            ws.onopen = () => { status.textContent = 'Connected'; };
            ws.onclose = () => {
                status.textContent = 'Disconnected â€” reconnecting...';
                setTimeout(connect, 2000);
            };
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'token') {
                    if (!currentAgentMsg) {
                        currentAgentMsg = addMessage('', 'agent');
                    }
                    currentAgentMsg.textContent += data.text;
                    chat.scrollTop = chat.scrollHeight;
                } else if (data.type === 'done') {
                    currentAgentMsg = null;
                    sendBtn.disabled = false;
                    input.disabled = false;
                    input.focus();
                    status.textContent = 'Ready';
                }
            };
        }

        function addMessage(text, role) {
            const div = document.createElement('div');
            div.className = `msg ${role}`;
            div.textContent = text;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
            return div;
        }

        function sendMessage() {
            const text = input.value.trim();
            if (!text || !ws || ws.readyState !== WebSocket.OPEN) return;
            addMessage(text, 'user');
            ws.send(text);
            input.value = '';
            sendBtn.disabled = true;
            input.disabled = true;
            status.textContent = 'Thinking...';
        }

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        connect();
    </script>
</body>
</html>
